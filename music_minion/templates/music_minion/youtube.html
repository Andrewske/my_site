{% extends "portfolio/base.html" %}

{% block content %}

{% if message %}
<div class='alert alert-danger message'>
  <p style="margin-bottom: 0px;">{{ message }}</p>
</div>
{% endif %}
<h2>Welcome to Music Minon's Youtube Page</h2>
<div id='loading-container'>
  <!--Thanks to El Alemano https://codepen.io/elalemanyo/pen/wueft-->
  <div id='bars'>
    <div class='bar'></div>
    <div class='bar'></div>
    <div class='bar'></div>
    <div class='bar'></div>
    <div class='bar'></div>
    <div class='bar'></div>
    <div class='bar'></div>
    <div class='bar'></div>
    <div class='bar'></div>
    <div class='bar'></div>
  </div>
  <p id='loading-text' class='hidden'></p>
</div>

<div id="choose-playlist" class="hidden">
  <legend class="border-bottom mb-4">1. Choose Playlist</legend>
  <select id='playlist-dropdown'></select>
  <form>
    <input class="chosen-playlist" type="text" value="" placeholder="Type to filter">
  </form>
  <button id="get-playlist-tracks" class="btn contact-button" type="submit">Get Tracks</button>
</div>

<div class="dropdown-container">
  <!--Special Thanks to Mari Johannessen https://codepen.io/marijoha/pen/zKjvEw-->
  <form>
    <input class="chosen-value" type="text" value="" placeholder="Type to filter">
    <ul class="value-list">
      <li>Alabama</li>
      <li>Alaska</li>
      <li>Arizona</li>
      <li>Arkansas</li>
      <li>California</li>
      <li>Colorado</li>
      <li>Connecticut</li>
      <li>Delaware</li>
      <li>Florida</li>
      <li>Georgia</li>
      <li>Hawaii</li>
      <li>Idaho</li>
      <li>Illinois</li>
      <li>Indiana</li>
      <li>Iowa</li>
      <li>Kansas</li>
      <li>Kentucky</li>
      <li>Louisiana</li>
      <li>Maine</li>
      <li>Maryland</li>
      <li>Massachusetts</li>
      <li>Michigan</li>
      <li>Minnesota</li>
      <li>Mississippi</li>
      <li>Missouri</li>
      <li>Montana</li>
      <li>Nebraska</li>
      <li>Nevada</li>
      <li>New Hampshire</li>
      <li>New Jersey</li>
      <li>New Mexico</li>
      <li>New York</li>
      <li>North Carolina</li>
      <li>North Dakota</li>
      <li>Ohio</li>
      <li>Oklahoma</li>
      <li>Oregon</li>
      <li>Pennsylvania</li>
      <li>Rhode Island</li>
      <li>South Carolina</li>
      <li>South Dakota</li>
      <li>Tennessee</li>
      <li>Texas</li>
      <li>Utah</li>
      <li>Vermont</li>
      <li>Virginia</li>
      <li>Washington</li>
      <li>West Virginia</li>
      <li>Wisconsin</li>
      <li>Wyoming</li>
    </ul>
  </form>
</div> 

<div id="results">

</div>

{% endblock content %}

{% block js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/prefixfree/1.0.7/prefixfree.min.js"></script>
<script>
  //   buildDropdown(
  //     data['items'],
  //     $('#playlist-dropdown'),
  //     'Select a playlist',
  // );

  // function buildDropdown(result, dropdown, emptyMessage) {
  //       $('#playlist-dropdown').html();
  //       dropdown.append('<option value="">' + emptyMessage + '</option>');

  //       if(result != '') {
  //           $.each(result, function(k,v) {
  //               dropdown.append('<option value="' + v.id + '">' + v.name + '</option>');
  //           });
  //       }
  //   }

  // class dropdown {
  //   constructor(data){
  //     this.data = data.items
  //   }
  // }

  // spotifyToken = null
  // youtubeToken = null
  // playlists = null

  // $(document).ready(function(event) {
  //   loadPage();
  // })
  
  // async function loadPage() {
  //       $('#loading-container').fadeIn(1000).removeClass('hidden');
  //       $('#loading-text').text("Checking Auth");
  //       $('#loading-text').fadeIn(1000).removeClass('hidden');
  //       await checkAuth();
  //       $('#loading-text').fadeOut(1000).addClass('hidden');
  //       $('#loading-container').fadeOut(1000).addClass('hidden');
  //       await getSpotifyPlaylists()
  //       let playlists = dropdown(playlists)
  //       console.log(playlists.data)
  //       setTimeout(() => {
  //           $('#choose-playlist').fadeIn(1000).removeClass('hidden')
  //       },1000);

        
  //   }

  // async function checkAuth() {
  //       console.log("Checking Auth")
  //       await $.ajax({
  //           type:'POST',
  //           url: '{% url "check_auth" %}',
  //           data: {'user_id':userId, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
  //           dataType:'json',
  //           success: function(data){
  //               spotifyToken = data[0];
  //               youtubeToken = data[1];
  //           },
  //           error: function(rs, e){
  //               console.log(rs.responseText);
  //           }
  //       });
  //       console.log("Auth Complete")
  // };
  
  // //Function to get a users spotify playlists
  // async function getSpotifyPlaylists() {
  //   await $.ajax ({
  //       type:'GET',
  //       url: 'https://api.spotify.com/v1/users/'+username+'/playlists',
  //       dataType:'json',
  //       data: {'limit':50},
  //       beforeSend: function (xhr) {
  //           xhr.setRequestHeader ("Authorization", "Bearer " + spotifyToken);
  //       },
        
  //       success: function(data) {
  //           playlists = data
  //           //console.log(data['items']);
  //           // buildDropdown(
  //           //     data['items'],
  //           //     $('#playlist-dropdown'),
  //           //     'Select a playlist',
  //           // );
  //       },
  //       error: function(rs, e){
  //           console.log(rs.responseText)
  //       }
  //   })
  //   return "finished"
  // };

  const inputField = document.querySelector('.chosen-value');
  const dropdown = document.querySelector('.value-list');
  const dropdownArray = [... document.querySelectorAll('li')];
  console.log(typeof dropdownArray)
  dropdown.classList.add('open');
  inputField.focus(); // Demo purposes only
  let valueArray = [];
  dropdownArray.forEach(item => {
    valueArray.push(item.textContent);
  });

  const closeDropdown = () => {
    dropdown.classList.remove('open');
  }

  inputField.addEventListener('input', () => {
    dropdown.classList.add('open');
    let inputValue = inputField.value.toLowerCase();
    let valueSubstring;
    if (inputValue.length > 0) {
      for (let j = 0; j < valueArray.length; j++) {
        if (!(inputValue.substring(0, inputValue.length) === valueArray[j].substring(0, inputValue.length).toLowerCase())) {
          dropdownArray[j].classList.add('closed');
        } else {
          dropdownArray[j].classList.remove('closed');
        }
      }
    } else {
      for (let i = 0; i < dropdownArray.length; i++) {
        dropdownArray[i].classList.remove('closed');
      }
    }
  });

  dropdownArray.forEach(item => {
    item.addEventListener('click', (evt) => {
      inputField.value = item.textContent;
      dropdownArray.forEach(dropdown => {
        dropdown.classList.add('closed');
      });
    });
  })

  inputField.addEventListener('focus', () => {
    inputField.placeholder = 'Type to filter';
    dropdown.classList.add('open');
    dropdownArray.forEach(dropdown => {
      dropdown.classList.remove('closed');
    });
  });

  inputField.addEventListener('blur', () => {
    inputField.placeholder = 'Select state';
    dropdown.classList.remove('open');
  });

  document.addEventListener('click', (evt) => {
    const isDropdown = dropdown.contains(evt.target);
    const isInput = inputField.contains(evt.target);
    if (!isDropdown && !isInput) {
      dropdown.classList.remove('open');
    }
  });
</script>
{% endblock js %}
