    var spotifyTracks = [{'id': '2RqZFOLOnzVmHUX7ZMcaES', 'name': 'Let It Go', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02911ef35f75422d0482cec8bf', 'artists': "Keyshia Cole, Missy Elliott, Lil' Kim", 'href': 'https://api.spotify.com/v1/tracks/2RqZFOLOnzVmHUX7ZMcaES', 'popularity': 66, 'uri': 'spotify:track:2RqZFOLOnzVmHUX7ZMcaES', 'release_date': '2007-01-01', 'danceability': 0.806, 'energy': 0.721, 'key': '3A', 'loudness': -5.167, 'mode': 0, 'speechiness': 0.215, 'acousticness': 0.197, 'instrumentalness': 0, 'liveness': 0.209, 'valence': 0.781, 'tempo': 94, 'time_signature': 4, 'duration_ms': 238333}, {'id': '7EwPR8nTPQpWl9qSXzkHpq', 'name': '21 Questions', 'img_url': 'https://i.scdn.co/image/ab67616d00001e020770fe27caff8948d0cea4ec', 'artists': 'Unwrapped', 'href': 'https://api.spotify.com/v1/tracks/7EwPR8nTPQpWl9qSXzkHpq', 'popularity': 26, 'uri': 'spotify:track:7EwPR8nTPQpWl9qSXzkHpq', 'release_date': '2005', 'danceability': 0.666, 'energy': 0.678, 'key': '1A', 'loudness': -6.007, 'mode': 0, 'speechiness': 0.0298, 'acousticness': 0.415, 'instrumentalness': 0.232, 'liveness': 0.127, 'valence': 0.633, 'tempo': 94, 'time_signature': 4, 'duration_ms': 266733}, {'id': '0aj2QKJvz6CePykmlTApiD', 'name': 'Señorita', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02346a5742374ab4cf9ed32dee', 'artists': 'Justin Timberlake', 'href': 'https://api.spotify.com/v1/tracks/0aj2QKJvz6CePykmlTApiD', 'popularity': 65, 'uri': 'spotify:track:0aj2QKJvz6CePykmlTApiD', 'release_date': '2002-11-04', 'danceability': 0.841, 'energy': 0.629, 'key': '3B', 'loudness': -5.351, 'mode': 1, 'speechiness': 0.0442, 'acousticness': 0.0729, 'instrumentalness': 0, 'liveness': 0.0742, 'valence': 0.87, 'tempo': 97, 'time_signature': 4, 'duration_ms': 294867}, {'id': '0uEp9E98JB5awlA084uaIg', 'name': 'Doo Wop (That Thing)', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02e08b1250db5f75643f1508c9', 'artists': 'Ms. Lauryn Hill', 'href': 'https://api.spotify.com/v1/tracks/0uEp9E98JB5awlA084uaIg', 'popularity': 73, 'uri': 'spotify:track:0uEp9E98JB5awlA084uaIg', 'release_date': '1998-08-25', 'danceability': 0.535, 'energy': 0.505, 'key': '7A', 'loudness': -8.926, 'mode': 0, 'speechiness': 0.245, 'acousticness': 0.0393, 'instrumentalness': 0, 'liveness': 0.0923, 'valence': 0.495, 'tempo': 99, 'time_signature': 4, 'duration_ms': 320267}, {'id': '3TjE3A8tLih7KBwKJ03Htl', 'name': 'New Vibe Who Dis (feat. Little League)', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02ebd63c63c3435d89535888a1', 'artists': 'Madison Mars, Little League', 'href': 'https://api.spotify.com/v1/tracks/3TjE3A8tLih7KBwKJ03Htl', 'popularity': 63, 'uri': 'spotify:track:3TjE3A8tLih7KBwKJ03Htl', 'release_date': '2019-08-23', 'danceability': 0.699, 'energy': 0.933, 'key': '3A', 'loudness': -3.504, 'mode': 0, 'speechiness': 0.175, 'acousticness': 0.16, 'instrumentalness': 5.62e-06, 'liveness': 0.196, 'valence': 0.646, 'tempo': 123, 'time_signature': 4, 'duration_ms': 191500}];
    var youtubeTracks = {'2RqZFOLOnzVmHUX7ZMcaES': [{'id': '2RqZFOLOnzVmHUX7ZMcaES', 'name': 'Let It Go', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02911ef35f75422d0482cec8bf', 'artists': "Keyshia Cole, Missy Elliott, Lil' Kim", 'href': 'https://api.spotify.com/v1/tracks/2RqZFOLOnzVmHUX7ZMcaES', 'popularity': 66, 'uri': 'spotify:track:2RqZFOLOnzVmHUX7ZMcaES', 'release_date': '2007-01-01', 'danceability': 0.806, 'energy': 0.721, 'key': '3A', 'loudness': -5.167, 'mode': 0, 'speechiness': 0.215, 'acousticness': 0.197, 'instrumentalness': 0, 'liveness': 0.209, 'valence': 0.781, 'tempo': 94, 'time_signature': 4, 'duration_ms': 238333}, {'id': '7EwPR8nTPQpWl9qSXzkHpq', 'name': '21 Questions', 'img_url': 'https://i.scdn.co/image/ab67616d00001e020770fe27caff8948d0cea4ec', 'artists': 'Unwrapped', 'href': 'https://api.spotify.com/v1/tracks/7EwPR8nTPQpWl9qSXzkHpq', 'popularity': 26, 'uri': 'spotify:track:7EwPR8nTPQpWl9qSXzkHpq', 'release_date': '2005', 'danceability': 0.666, 'energy': 0.678, 'key': '1A', 'loudness': -6.007, 'mode': 0, 'speechiness': 0.0298, 'acousticness': 0.415, 'instrumentalness': 0.232, 'liveness': 0.127, 'valence': 0.633, 'tempo': 94, 'time_signature': 4, 'duration_ms': 266733}, {'id': '0aj2QKJvz6CePykmlTApiD', 'name': 'Señorita', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02346a5742374ab4cf9ed32dee', 'artists': 'Justin Timberlake', 'href': 'https://api.spotify.com/v1/tracks/0aj2QKJvz6CePykmlTApiD', 'popularity': 65, 'uri': 'spotify:track:0aj2QKJvz6CePykmlTApiD', 'release_date': '2002-11-04', 'danceability': 0.841, 'energy': 0.629, 'key': '3B', 'loudness': -5.351, 'mode': 1, 'speechiness': 0.0442, 'acousticness': 0.0729, 'instrumentalness': 0, 'liveness': 0.0742, 'valence': 0.87, 'tempo': 97, 'time_signature': 4, 'duration_ms': 294867}, {'id': '0uEp9E98JB5awlA084uaIg', 'name': 'Doo Wop (That Thing)', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02e08b1250db5f75643f1508c9', 'artists': 'Ms. Lauryn Hill', 'href': 'https://api.spotify.com/v1/tracks/0uEp9E98JB5awlA084uaIg', 'popularity': 73, 'uri': 'spotify:track:0uEp9E98JB5awlA084uaIg', 'release_date': '1998-08-25', 'danceability': 0.535, 'energy': 0.505, 'key': '7A', 'loudness': -8.926, 'mode': 0, 'speechiness': 0.245, 'acousticness': 0.0393, 'instrumentalness': 0, 'liveness': 0.0923, 'valence': 0.495, 'tempo': 99, 'time_signature': 4, 'duration_ms': 320267}, {'id': '3TjE3A8tLih7KBwKJ03Htl', 'name': 'New Vibe Who Dis (feat. Little League)', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02ebd63c63c3435d89535888a1', 'artists': 'Madison Mars, Little League', 'href': 'https://api.spotify.com/v1/tracks/3TjE3A8tLih7KBwKJ03Htl', 'popularity': 63, 'uri': 'spotify:track:3TjE3A8tLih7KBwKJ03Htl', 'release_date': '2019-08-23', 'danceability': 0.699, 'energy': 0.933, 'key': '3A', 'loudness': -3.504, 'mode': 0, 'speechiness': 0.175, 'acousticness': 0.16, 'instrumentalness': 5.62e-06, 'liveness': 0.196, 'valence': 0.646, 'tempo': 123, 'time_signature': 4, 'duration_ms': 191500}],'7EwPR8nTPQpWl9qSXzkHpq': [{'id': '2RqZFOLOnzVmHUX7ZMcaES', 'name': 'Let It Go', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02911ef35f75422d0482cec8bf', 'artists': "Keyshia Cole, Missy Elliott, Lil' Kim", 'href': 'https://api.spotify.com/v1/tracks/2RqZFOLOnzVmHUX7ZMcaES', 'popularity': 66, 'uri': 'spotify:track:2RqZFOLOnzVmHUX7ZMcaES', 'release_date': '2007-01-01', 'danceability': 0.806, 'energy': 0.721, 'key': '3A', 'loudness': -5.167, 'mode': 0, 'speechiness': 0.215, 'acousticness': 0.197, 'instrumentalness': 0, 'liveness': 0.209, 'valence': 0.781, 'tempo': 94, 'time_signature': 4, 'duration_ms': 238333}, {'id': '7EwPR8nTPQpWl9qSXzkHpq', 'name': '21 Questions', 'img_url': 'https://i.scdn.co/image/ab67616d00001e020770fe27caff8948d0cea4ec', 'artists': 'Unwrapped', 'href': 'https://api.spotify.com/v1/tracks/7EwPR8nTPQpWl9qSXzkHpq', 'popularity': 26, 'uri': 'spotify:track:7EwPR8nTPQpWl9qSXzkHpq', 'release_date': '2005', 'danceability': 0.666, 'energy': 0.678, 'key': '1A', 'loudness': -6.007, 'mode': 0, 'speechiness': 0.0298, 'acousticness': 0.415, 'instrumentalness': 0.232, 'liveness': 0.127, 'valence': 0.633, 'tempo': 94, 'time_signature': 4, 'duration_ms': 266733}, {'id': '0aj2QKJvz6CePykmlTApiD', 'name': 'Señorita', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02346a5742374ab4cf9ed32dee', 'artists': 'Justin Timberlake', 'href': 'https://api.spotify.com/v1/tracks/0aj2QKJvz6CePykmlTApiD', 'popularity': 65, 'uri': 'spotify:track:0aj2QKJvz6CePykmlTApiD', 'release_date': '2002-11-04', 'danceability': 0.841, 'energy': 0.629, 'key': '3B', 'loudness': -5.351, 'mode': 1, 'speechiness': 0.0442, 'acousticness': 0.0729, 'instrumentalness': 0, 'liveness': 0.0742, 'valence': 0.87, 'tempo': 97, 'time_signature': 4, 'duration_ms': 294867}, {'id': '0uEp9E98JB5awlA084uaIg', 'name': 'Doo Wop (That Thing)', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02e08b1250db5f75643f1508c9', 'artists': 'Ms. Lauryn Hill', 'href': 'https://api.spotify.com/v1/tracks/0uEp9E98JB5awlA084uaIg', 'popularity': 73, 'uri': 'spotify:track:0uEp9E98JB5awlA084uaIg', 'release_date': '1998-08-25', 'danceability': 0.535, 'energy': 0.505, 'key': '7A', 'loudness': -8.926, 'mode': 0, 'speechiness': 0.245, 'acousticness': 0.0393, 'instrumentalness': 0, 'liveness': 0.0923, 'valence': 0.495, 'tempo': 99, 'time_signature': 4, 'duration_ms': 320267}, {'id': '3TjE3A8tLih7KBwKJ03Htl', 'name': 'New Vibe Who Dis (feat. Little League)', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02ebd63c63c3435d89535888a1', 'artists': 'Madison Mars, Little League', 'href': 'https://api.spotify.com/v1/tracks/3TjE3A8tLih7KBwKJ03Htl', 'popularity': 63, 'uri': 'spotify:track:3TjE3A8tLih7KBwKJ03Htl', 'release_date': '2019-08-23', 'danceability': 0.699, 'energy': 0.933, 'key': '3A', 'loudness': -3.504, 'mode': 0, 'speechiness': 0.175, 'acousticness': 0.16, 'instrumentalness': 5.62e-06, 'liveness': 0.196, 'valence': 0.646, 'tempo': 123, 'time_signature': 4, 'duration_ms': 191500}],'0aj2QKJvz6CePykmlTApiD': [{'id': '2RqZFOLOnzVmHUX7ZMcaES', 'name': 'Let It Go', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02911ef35f75422d0482cec8bf', 'artists': "Keyshia Cole, Missy Elliott, Lil' Kim", 'href': 'https://api.spotify.com/v1/tracks/2RqZFOLOnzVmHUX7ZMcaES', 'popularity': 66, 'uri': 'spotify:track:2RqZFOLOnzVmHUX7ZMcaES', 'release_date': '2007-01-01', 'danceability': 0.806, 'energy': 0.721, 'key': '3A', 'loudness': -5.167, 'mode': 0, 'speechiness': 0.215, 'acousticness': 0.197, 'instrumentalness': 0, 'liveness': 0.209, 'valence': 0.781, 'tempo': 94, 'time_signature': 4, 'duration_ms': 238333}, {'id': '7EwPR8nTPQpWl9qSXzkHpq', 'name': '21 Questions', 'img_url': 'https://i.scdn.co/image/ab67616d00001e020770fe27caff8948d0cea4ec', 'artists': 'Unwrapped', 'href': 'https://api.spotify.com/v1/tracks/7EwPR8nTPQpWl9qSXzkHpq', 'popularity': 26, 'uri': 'spotify:track:7EwPR8nTPQpWl9qSXzkHpq', 'release_date': '2005', 'danceability': 0.666, 'energy': 0.678, 'key': '1A', 'loudness': -6.007, 'mode': 0, 'speechiness': 0.0298, 'acousticness': 0.415, 'instrumentalness': 0.232, 'liveness': 0.127, 'valence': 0.633, 'tempo': 94, 'time_signature': 4, 'duration_ms': 266733}, {'id': '0aj2QKJvz6CePykmlTApiD', 'name': 'Señorita', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02346a5742374ab4cf9ed32dee', 'artists': 'Justin Timberlake', 'href': 'https://api.spotify.com/v1/tracks/0aj2QKJvz6CePykmlTApiD', 'popularity': 65, 'uri': 'spotify:track:0aj2QKJvz6CePykmlTApiD', 'release_date': '2002-11-04', 'danceability': 0.841, 'energy': 0.629, 'key': '3B', 'loudness': -5.351, 'mode': 1, 'speechiness': 0.0442, 'acousticness': 0.0729, 'instrumentalness': 0, 'liveness': 0.0742, 'valence': 0.87, 'tempo': 97, 'time_signature': 4, 'duration_ms': 294867}, {'id': '0uEp9E98JB5awlA084uaIg', 'name': 'Doo Wop (That Thing)', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02e08b1250db5f75643f1508c9', 'artists': 'Ms. Lauryn Hill', 'href': 'https://api.spotify.com/v1/tracks/0uEp9E98JB5awlA084uaIg', 'popularity': 73, 'uri': 'spotify:track:0uEp9E98JB5awlA084uaIg', 'release_date': '1998-08-25', 'danceability': 0.535, 'energy': 0.505, 'key': '7A', 'loudness': -8.926, 'mode': 0, 'speechiness': 0.245, 'acousticness': 0.0393, 'instrumentalness': 0, 'liveness': 0.0923, 'valence': 0.495, 'tempo': 99, 'time_signature': 4, 'duration_ms': 320267}, {'id': '3TjE3A8tLih7KBwKJ03Htl', 'name': 'New Vibe Who Dis (feat. Little League)', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02ebd63c63c3435d89535888a1', 'artists': 'Madison Mars, Little League', 'href': 'https://api.spotify.com/v1/tracks/3TjE3A8tLih7KBwKJ03Htl', 'popularity': 63, 'uri': 'spotify:track:3TjE3A8tLih7KBwKJ03Htl', 'release_date': '2019-08-23', 'danceability': 0.699, 'energy': 0.933, 'key': '3A', 'loudness': -3.504, 'mode': 0, 'speechiness': 0.175, 'acousticness': 0.16, 'instrumentalness': 5.62e-06, 'liveness': 0.196, 'valence': 0.646, 'tempo': 123, 'time_signature': 4, 'duration_ms': 191500}],'0uEp9E98JB5awlA084uaIg': [{'id': '2RqZFOLOnzVmHUX7ZMcaES', 'name': 'Let It Go', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02911ef35f75422d0482cec8bf', 'artists': "Keyshia Cole, Missy Elliott, Lil' Kim", 'href': 'https://api.spotify.com/v1/tracks/2RqZFOLOnzVmHUX7ZMcaES', 'popularity': 66, 'uri': 'spotify:track:2RqZFOLOnzVmHUX7ZMcaES', 'release_date': '2007-01-01', 'danceability': 0.806, 'energy': 0.721, 'key': '3A', 'loudness': -5.167, 'mode': 0, 'speechiness': 0.215, 'acousticness': 0.197, 'instrumentalness': 0, 'liveness': 0.209, 'valence': 0.781, 'tempo': 94, 'time_signature': 4, 'duration_ms': 238333}, {'id': '7EwPR8nTPQpWl9qSXzkHpq', 'name': '21 Questions', 'img_url': 'https://i.scdn.co/image/ab67616d00001e020770fe27caff8948d0cea4ec', 'artists': 'Unwrapped', 'href': 'https://api.spotify.com/v1/tracks/7EwPR8nTPQpWl9qSXzkHpq', 'popularity': 26, 'uri': 'spotify:track:7EwPR8nTPQpWl9qSXzkHpq', 'release_date': '2005', 'danceability': 0.666, 'energy': 0.678, 'key': '1A', 'loudness': -6.007, 'mode': 0, 'speechiness': 0.0298, 'acousticness': 0.415, 'instrumentalness': 0.232, 'liveness': 0.127, 'valence': 0.633, 'tempo': 94, 'time_signature': 4, 'duration_ms': 266733}, {'id': '0aj2QKJvz6CePykmlTApiD', 'name': 'Señorita', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02346a5742374ab4cf9ed32dee', 'artists': 'Justin Timberlake', 'href': 'https://api.spotify.com/v1/tracks/0aj2QKJvz6CePykmlTApiD', 'popularity': 65, 'uri': 'spotify:track:0aj2QKJvz6CePykmlTApiD', 'release_date': '2002-11-04', 'danceability': 0.841, 'energy': 0.629, 'key': '3B', 'loudness': -5.351, 'mode': 1, 'speechiness': 0.0442, 'acousticness': 0.0729, 'instrumentalness': 0, 'liveness': 0.0742, 'valence': 0.87, 'tempo': 97, 'time_signature': 4, 'duration_ms': 294867}, {'id': '0uEp9E98JB5awlA084uaIg', 'name': 'Doo Wop (That Thing)', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02e08b1250db5f75643f1508c9', 'artists': 'Ms. Lauryn Hill', 'href': 'https://api.spotify.com/v1/tracks/0uEp9E98JB5awlA084uaIg', 'popularity': 73, 'uri': 'spotify:track:0uEp9E98JB5awlA084uaIg', 'release_date': '1998-08-25', 'danceability': 0.535, 'energy': 0.505, 'key': '7A', 'loudness': -8.926, 'mode': 0, 'speechiness': 0.245, 'acousticness': 0.0393, 'instrumentalness': 0, 'liveness': 0.0923, 'valence': 0.495, 'tempo': 99, 'time_signature': 4, 'duration_ms': 320267}, {'id': '3TjE3A8tLih7KBwKJ03Htl', 'name': 'New Vibe Who Dis (feat. Little League)', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02ebd63c63c3435d89535888a1', 'artists': 'Madison Mars, Little League', 'href': 'https://api.spotify.com/v1/tracks/3TjE3A8tLih7KBwKJ03Htl', 'popularity': 63, 'uri': 'spotify:track:3TjE3A8tLih7KBwKJ03Htl', 'release_date': '2019-08-23', 'danceability': 0.699, 'energy': 0.933, 'key': '3A', 'loudness': -3.504, 'mode': 0, 'speechiness': 0.175, 'acousticness': 0.16, 'instrumentalness': 5.62e-06, 'liveness': 0.196, 'valence': 0.646, 'tempo': 123, 'time_signature': 4, 'duration_ms': 191500}],'3TjE3A8tLih7KBwKJ03Htl': [{'id': '2RqZFOLOnzVmHUX7ZMcaES', 'name': 'Let It Go', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02911ef35f75422d0482cec8bf', 'artists': "Keyshia Cole, Missy Elliott, Lil' Kim", 'href': 'https://api.spotify.com/v1/tracks/2RqZFOLOnzVmHUX7ZMcaES', 'popularity': 66, 'uri': 'spotify:track:2RqZFOLOnzVmHUX7ZMcaES', 'release_date': '2007-01-01', 'danceability': 0.806, 'energy': 0.721, 'key': '3A', 'loudness': -5.167, 'mode': 0, 'speechiness': 0.215, 'acousticness': 0.197, 'instrumentalness': 0, 'liveness': 0.209, 'valence': 0.781, 'tempo': 94, 'time_signature': 4, 'duration_ms': 238333}, {'id': '7EwPR8nTPQpWl9qSXzkHpq', 'name': '21 Questions', 'img_url': 'https://i.scdn.co/image/ab67616d00001e020770fe27caff8948d0cea4ec', 'artists': 'Unwrapped', 'href': 'https://api.spotify.com/v1/tracks/7EwPR8nTPQpWl9qSXzkHpq', 'popularity': 26, 'uri': 'spotify:track:7EwPR8nTPQpWl9qSXzkHpq', 'release_date': '2005', 'danceability': 0.666, 'energy': 0.678, 'key': '1A', 'loudness': -6.007, 'mode': 0, 'speechiness': 0.0298, 'acousticness': 0.415, 'instrumentalness': 0.232, 'liveness': 0.127, 'valence': 0.633, 'tempo': 94, 'time_signature': 4, 'duration_ms': 266733}, {'id': '0aj2QKJvz6CePykmlTApiD', 'name': 'Señorita', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02346a5742374ab4cf9ed32dee', 'artists': 'Justin Timberlake', 'href': 'https://api.spotify.com/v1/tracks/0aj2QKJvz6CePykmlTApiD', 'popularity': 65, 'uri': 'spotify:track:0aj2QKJvz6CePykmlTApiD', 'release_date': '2002-11-04', 'danceability': 0.841, 'energy': 0.629, 'key': '3B', 'loudness': -5.351, 'mode': 1, 'speechiness': 0.0442, 'acousticness': 0.0729, 'instrumentalness': 0, 'liveness': 0.0742, 'valence': 0.87, 'tempo': 97, 'time_signature': 4, 'duration_ms': 294867}, {'id': '0uEp9E98JB5awlA084uaIg', 'name': 'Doo Wop (That Thing)', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02e08b1250db5f75643f1508c9', 'artists': 'Ms. Lauryn Hill', 'href': 'https://api.spotify.com/v1/tracks/0uEp9E98JB5awlA084uaIg', 'popularity': 73, 'uri': 'spotify:track:0uEp9E98JB5awlA084uaIg', 'release_date': '1998-08-25', 'danceability': 0.535, 'energy': 0.505, 'key': '7A', 'loudness': -8.926, 'mode': 0, 'speechiness': 0.245, 'acousticness': 0.0393, 'instrumentalness': 0, 'liveness': 0.0923, 'valence': 0.495, 'tempo': 99, 'time_signature': 4, 'duration_ms': 320267}, {'id': '3TjE3A8tLih7KBwKJ03Htl', 'name': 'New Vibe Who Dis (feat. Little League)', 'img_url': 'https://i.scdn.co/image/ab67616d00001e02ebd63c63c3435d89535888a1', 'artists': 'Madison Mars, Little League', 'href': 'https://api.spotify.com/v1/tracks/3TjE3A8tLih7KBwKJ03Htl', 'popularity': 63, 'uri': 'spotify:track:3TjE3A8tLih7KBwKJ03Htl', 'release_date': '2019-08-23', 'danceability': 0.699, 'energy': 0.933, 'key': '3A', 'loudness': -3.504, 'mode': 0, 'speechiness': 0.175, 'acousticness': 0.16, 'instrumentalness': 5.62e-06, 'liveness': 0.196, 'valence': 0.646, 'tempo': 123, 'time_signature': 4, 'duration_ms': 191500}]};

    var currentSpotifyTrack = '2RqZFOLOnzVmHUX7ZMcaES';
    
    var confirmedTracks = []
    var rejectedTracks = []
    var youtubePlaylist = []

    var user_access_token = '{{ user_access_token }}'
    var playlist_id = '5zaqtQk3NGJwstUuyAR8SW'

    $(document).ready(function(event){
        console.log('token = ' + user_access_token);
        //Get Spotify playlist tracks
        $(document).on('click', '#get_playlist_tracks', function(event){
            event.preventDefault();
            timeFunction(spotify_playlist_call(playlist_id));
            //timeFunction(getTracks());
            
        });

        $(document).on('click', '#next-spotify', function(event){
            event.preventDefault();
            loadTrack('next', 'spotify');
        });

        $(document).on('click', '#previous-spotify', function(event){
            event.preventDefault();
            loadTrack('previous', 'spotify');
        });

        $(document).on('click', '#next-youtube', function(event){
            event.preventDefault();
            loadTrack('next', 'youtube');
        });

        $(document).on('click', '#previous-youtube', function(event){
            event.preventDefault();
            loadTrack('previous', 'youtube');
        });

        $(document).on('click', '#confirm', function(event){
            event.preventDefault();
            //confirm this pairing
            let spotifyTrack = document.getElementById("spotify-card-data").firstElementChild.id.split("-")[1]
            let youtubeTrack = document.getElementById("youtube-card-data").firstElementChild.id.split("-")[1]
            let state = confirmTracks(spotifyTrack, youtubeTrack);
            if (state == 'finished') {
                finish();
            }
        });

        $(document).on('click', '#reject', function(event){
            event.preventDefault();
            //reject this pairing
            let spotifyTrack = document.getElementById("spotify-card-data").firstElementChild.id.split("-")[1]
            let youtubeTrack = document.getElementById("youtube-card-data").firstElementChild.id.split("-")[1]
            let state = rejectTracks(spotifyTrack, youtubeTrack);
            if (state == 'finished') {
                finish();
            }
        });

        $(document).on('click', '#show-confirmed', function(event){
            event.preventDefault();
            showTracks('confirmed');
        });

        $(document).on('click', '#show-rejected', function(event){
            event.preventDefault();
            showTracks('rejected');
        });

        $(document).on('click', '#save-playlist', function(event){
            event.preventDefault();
            savePlaylist();
            
        });
    });


    async function timeFunction(callback) {
        t0 = performance.now();
        let results = await callback;
        t1 = performance.now();
        console.log("Get tracks took " + (t1-t0) + "seconds");
        return results
    };

    function showTracks(result) {
        let table = `
        <table data-toggle="table">
            <thead>
                <tr>
                    <th data-sortable="true" data-visible="true">Spotify Track</th>
                    <th data-sortable="true" data-visible="true">Youtube Video</th>
                </tr>
            </thead>
            <tbody id='tracks-table'>
            </tbody>    
        </table>
        `
        document.getElementById('result-tracks').innerHTML = table
        tableElem = document.getElementById('tracks-table')
        if (result == 'confirmed') {
            confirmedTracks.forEach((track) => {
            row = `
            <tr>
                <td>${track[0].name}</td>
                <td>${track[1].name}</td>
            </tr>
            `
            tableElem.innerHTML += row
            });
        } else if (result == 'rejected') {
            console.log(rejectedTracks)
            rejectedTracks.forEach((track) => {
            row = `
            <tr>
                <td>${track.name}</td>
                <td>None<td>
            </tr>
            `
            tableElem.innerHTML += row
            });
        };  
    }

    function finish() {
        //Get all the confirmed tracks
        let nConfirmed = confirmedTracks.length
        let nRejected = rejectedTracks.length
        let nTotal = nConfirmed + nRejected

        let finishMessage = `
        <div>
            <legend class="border-bottom mb-4">3. Confirm Songs</legend>
            <h1>You confirmed ${nConfirmed}/${nTotal} tracks</h1>
            <button id="show-confirmed">Show confirmed tracks</button>
            <h2>No Matches: ${nRejected}</h2>
            <button id="show-rejected">Show confirmed tracks</button>
            </br>
            <form>
                <input type="text" value="Add YouTube Urls"></input>
                <button id="add-track" class="btn contact-button" type="submit">Add Track</button>
            </form>
            <button id="save-playlist" class="btn contact-button" type="submit">Save Playlist</button>
            <hr>
            <div id="result-tracks"></div>
        </div>          
        `
        document.getElementById('tracks').innerHTML = finishMessage
    }

    function confirmTracks(spotifyTrack, youtubeTrack) {
        //grab the track id for spotify and youtube and add to confirm list
        let spotifyTrackIndex = spotifyTracks.findIndex(t => t.id == spotifyTrack)

        let youtubeTrackIndex = youtubeTracks[currentSpotifyTrack].findIndex(t => t.id == youtubeTrack);
        confirmedTracks.push([spotifyTracks[spotifyTrackIndex], youtubeTracks[currentSpotifyTrack][youtubeTrackIndex]])
        youtubePlaylist.push(youtubeTracks[currentSpotifyTrack][youtubeTrackIndex].id)
        spotifyTracks.splice(spotifyTrackIndex,1)
        console.log(spotifyTracks)
        if(spotifyTracks.length > 0) {
            delete youtubeTracks[spotifyTrack];
            loadTrack('current', 'spotify');
            return 'next';
        } else {
            return 'finished';
        };
    };

    function rejectTracks(spotifyTrack, youtubeTrack) {
        let spotifyTrackIndex = spotifyTracks.findIndex(t => t.id == spotifyTrack)
        let youtubeTrackIndex = youtubeTracks[currentSpotifyTrack].findIndex(t => t.id == youtubeTrack);

        youtubeTracks[currentSpotifyTrack].splice(youtubeTrackIndex, 1);
        if (youtubeTracks[currentSpotifyTrack].length == 0) {
            rejectedTracks.push(spotifyTracks[spotifyTrackIndex])
            spotifyTracks.splice(spotifyTrackIndex,1)
            if (spotifyTracks.length == 0) {
                return "finished";
            } else {
                delete youtubeTracks[spotifyTrack];
                loadTrack('current', 'spotify');
                return "next";
            };
        } else {
            loadTrack('current', 'youtube');
            return "next";
        };
    }

    async function loadTrack(direction, platform) {
        if(platform == 'spotify') {
            //set the new track number
            let trackNumber = await setCount(direction, platform);
            spotifyTrack = spotifyTracks[trackNumber-1];
            youtubeTrack = youtubeTracks[spotifyTrack['id']][0];
            let trackId = await createTrackCard(spotifyTrack,'spotify');

            setCount('first', 'youtube')
            createTrackCard(youtubeTrack, 'youtube');
        } else if(platform == 'youtube') {
            let trackNumber = await setCount(direction, platform);

            youtubeTrack = youtubeTracks[currentSpotifyTrack][trackNumber-1];
            console.log(youtubeTrack)
            createTrackCard(youtubeTrack, 'youtube');
        } else {
            console.log("no platform")
        };
    };

    async function setCount(direction, platform) {
        let count = document.getElementById(platform + '-card-count');
        let current = parseInt(count.textContent.split("/")[0]);
        
        //Need to reset the current spotify track before loading the length
        let length = (platform =='spotify') ? spotifyTracks.length : youtubeTracks[currentSpotifyTrack].length;

        let trackNumber = (direction == 'next') ? next(current, length) : (direction == 'previous') ? previous(current, length) : (direction=='current' && current <= length) ? current : 1;
        count.innerText = trackNumber.toString() + "/" + length.toString();
        return trackNumber
    };

    function next(x, y) {
        return x>=y ? 1 : x+1;
    };

    function previous(x, y) {
        return x==1 ? y : x-1;
    };

    function createDiv(data, callback){
        $(".track-list").append(`<div id="${data['id']}" class="row"></div>`);
        callback(data, 'spotify');
    };

    function createTrackCard(track, platform){
        if(platform=='spotify') {
            currentSpotifyTrack = track['id'];
        };

        let trackCard = `
            <div id="${platform}-${track.id}" class="${platform}-track-card">
                <img class="track-card-img" src="${track.img_url}" alt="${track.img_url}">
                <div class="card-body">
                    <h3 class="card-title">${track.name}</h3>
                    <p class="card-text">${track.artists}</p>
                </div>
            </div>
            `;
        let divId = platform + "-card-data";
        let row = document.getElementById(divId);
        row.innerHTML = trackCard;
        return track['id']
    };



    async function getTracks() {
        try {
            spotifyTracks = await timeFunction(getSpotifyTracks());
            /*
            for(var i = 0; i < spotifyTracks.length; i++) {
                let track = await getYouTubeTracks(spotifyTracks[i],i);
                youtubeTracks[track[0]] = track[1];
            };
            */
            console.log(spotifyTracks)
            currentSpotifyTrack = spotifyTracks[0];
            currentYoutubeTrack = youtubeTracks[currentSpotifyTrack['id']][0];

            createTrackCard(currentSpotifyTrack, 'spotify');
            createTrackCard(currentYoutubeTrack, 'youtube');

        } catch(error) {
            console.error("error", error);
        };
    };

    async function getSpotifyTracks(){
        var form = document.playlist;
        let playlistId = form.playlist.value;
        let use = 'list';
        let tracks = null
        let userId = '{{ user.id }}';

        //Make an Ajax request to the Get Playlist tracks URL
        await $.ajax({
            type:'POST',
            url: '{% url "get_playlist_tracks" %}',
            data: {'user_id':userId, 'playlist_id':playlistId, 'csrfmiddlewaretoken': '{{ csrf_token }}', 'use': use},
            dataType:'json',
            success: function(data){
                console.log("We got some tracks")
                //Take the resonse and add a Card for each Spotify track
                if(data){
                    tracks = data
                } else {
                    console.log('No tracks');
                }}, 
            error: function(rs, e){
                console.log(rs.responseText);
            }
        });
        let count = document.getElementById('spotify-card-count');
        count.innerText = "1/" + tracks.length.toString();
        return tracks
    };

    async function spotify_playlist_call(playlist_id) {
        console.log('https://api.spotify.com/v1/playlists/' + playlist_id + '/tracks')
        let tracks = await $.ajax({
            type:'GET',
            url:'https://api.spotify.com/v1/playlists/' + playlist_id + '/tracks',
            data: {'market':'from_token'},
            dataType:'json',
            beforeSend: function (xhr) {
                xhr.setRequestHeader ("Authorization", "Bearer " + user_access_token);
            },
            
            success: function(data) {
                console.log(data)
                return data;
            },
            error: function(rs, e){
                console.log(rs.responseText)
                return "Nada"
            }
        });
        console.log(tracks)
    };

    async function getYouTubeTracks(track, i) {
        let trackId = track['id'];
        let trackName = track['name'];
        let trackArtists = track['artists'];
        let userId = '{{ user.id }}';
        let trackData = await $.ajax({
            type:"POST",
            url:'{% url "get_youtube_tracks" %}',
            data: {'user_id':userId, 'track_id':trackId, 'artists':trackArtists, 'name':trackName, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
            dataType:'json',
            success: function(data) {
                return data
            },
            error: function(rs, e){
                console.log(rs.responseText)
                return "Nada"
            }
        });
        let count = document.getElementById('youtube-card-count');
        count.innerText = "1/" + trackData.length.toString();
        return [trackId, trackData]
    };

    async function savePlaylist() {
        let userId = '{{ user.id }}';
        let playlistName = "Omnia";
        console.log(youtubePlaylist)
        let response = await $.ajax({
            type:"POST",
            url:'{% url "make_youtube_playlist" %}',
            data: {'user_id':userId, 'track_ids':JSON.stringify(youtubePlaylist), 'playlist_name':playlistName, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
            dataType:'json',
            success: function(data) {
                return data
            },
            error: function(rs, e){
                console.log(rs.responseText)
                return "Nada"
            }
        });
        success(response)
    };

    function success(data) {
        let success = `
        <div>
            <h1>Sucess!</h1>
            <p>You have created a new Youtube playlist</p>
        </div>
        `
        console.log(data);
        document.getElementById("tracks").innerHTML = success;
    }
